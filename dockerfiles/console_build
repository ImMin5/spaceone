FROM node:12

ENV PORT 80
ENV BUILD_PATH /tmp/spaceone/build
ENV ROOT_PATH /var/www
ENV LOG_PATH /var/log/spaceone
ENV NGINX_CONF_PATH /etc/nginx/conf.d
ENV NODE_ENV production

WORKDIR ${BUILD_PATH}

RUN mkdir -p ${BUILD_PATH} \
    && apt-get update && apt-get install -y nginx \
    && rm -f /etc/nginx/sites-enabled/default \
    && mkdir -p ${BUILD_PATH} && mkdir -p ${LOG_PATH}/nginx
    
COPY pkg/nginx.conf ${NGINX_CONF_PATH}/spaceone_console.conf
COPY tsconfig.json ${BUILD_PATH}/
COPY vue.config.js ${BUILD_PATH}/
COPY public ${BUILD_PATH}/public
COPY package.json package-lock.json *.js ${BUILD_PATH}/
RUN npm install